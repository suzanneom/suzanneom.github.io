<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <title>Cryptomania</title>

    <!-- Bootstrap core CSS -->
    <link href="bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="../../assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/navbar-static-top.css" rel="stylesheet" type="text/css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
	
	<!--<link href='//fonts.googleapis.com/css?family=Abril Fatface' rel='stylesheet'>-->
	
  </head>
  
  <body onload="on_load()">

    <!-- Static navbar -->
    <nav class="navbar navbar-default navbar-static-top">
      <div class="container">
        <div class="navbar-header">
          <p id="name_label">Cryptomania</p>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="#" onclick="location.reload();" style="font-size: 20px;">New Puzzle</a></li>
            <!--<li><a href="#" onclick="go_to_about()">About</a></li>-->
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

	
    <div class="container">

      <!-- Main component for a primary marketing message or call to action -->
      <div class="jumbotron" id = "main_jumbotron">
        <form name="open_form" action="" method="GET">
			<p style="font-size: 16px;">Fill in the blanks with the appropriate letters in order to decode the phrase. </p>
			<table id="letter_table">
			
				<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
				<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
				<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
				<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
				<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
				<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
				<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
				<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
				<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
				<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
					<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
			</table>
			<br>
			<input type="button" name="submit" value="SUBMIT" onclick="check_answer()"/>
		</form>
      </div>
	
	  <!--<div class="jumbotron" id="about_jumbtron" style="display: none;">
		<h1>Welcome to Cryptomania!</h1>
		<p>Fill in the spaces with the decoded version of the phrase shown. The decoded phrases are all 
			quotes in modern english. Counting letter frequencies may help in solving the puzzle. </p>
	  </div>-->
	  
	  <div class="jumbotron" id="response_jumbotron" style="display: none;">
		<h2 id="response"></h2>
		<p id="response_p" style="font-size:16px;"></p>
		<table><tr>
		<td><button type="button" onclick="go_back()" id="try_button">Try Again</button></td>
		<td><button type="button" onclick="location.reload()" id="new_button">New Game</button></td>
		</tr><table>
	  </div>
	
    </div> <!-- /container -->

	<script>
		var original_phrase = ''
	
		function select_phrase() {
			var phrases = ['all men must die','problems worthy of attack prove their worth by fighting back',
			'imagination is more important than knowledge','the important thing is not to stop questioning',
			'anyone who has never made a mistake has never tried anything new',
			'an eye for an eye makes the whole world blind','you must be the change you wish to see in the world',
			'happiness is when what you think, what you say, and what you do are in harmony',
			'it does not do well to dwell on dreams and forget to live',
			'never trust anything that can think for itself if you cannot see where it keeps its brain'];
			index = Math.floor((Math.random())*(phrases.length));
			return phrases[index];
		}
	
		function phrase_encode(phrase) {
			ordered_letters = ['a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z'];
			scrambled_letters = [];
			count = 0;
			while (count < 26) {
				insert_spot = Math.floor((Math.random())*(scrambled_letters.length));
				scrambled_letters.splice(insert_spot, 0, ordered_letters[count]);
				count += 1;
			}
			
			var count = 0;
			var new_phrase = '';
			var num = phrase.length;
			while (count < phrase.length) {
				letter = phrase[count];
				var count2 = 0;
				var count3 = 0
				while ((count2 < ordered_letters.length) && (count3 == 0)) {
					if (ordered_letters[count2] == letter) {
						new_phrase = new_phrase.concat(scrambled_letters[count2]);
						count3 = 1;
					}
					count2 += 1;
				}
				if (count3 == 0) {
					new_phrase = new_phrase.concat(letter);
				}
				count += 1;
			}
			
			return(new_phrase);
		}
		
		function fill_grid(phrase) {
			//break up phrase into smaller segments that each fit on a single line-height
			//alert(original_phrase);
			var count = 0;
			var lines = [];
			var current_line = '';
			while (count <= phrase.length) {
				if (phrase[count] == ' ') {
					if (current_line.length > 39) {
						//alert('have to make new line');
						while (phrase[count] != ' ') {
							current_line = current_line.substring(0, current_line.length - 1);
							count -= 1;
						}
						lines.push(current_line);
						current_line = '';
					}
					else {
						current_line = current_line.concat(phrase[count]);
					}
				}
				else {
					current_line = current_line.concat(phrase[count]);
				}
				count += 1;
				if (count == phrase.length) {
					lines.push(current_line);
				}
			}
			
			//assigning form inputs and letters to the grid
			count = 0;
			var letter_count = 0;
			while (count <= lines.length) {
				count2 = 0;
				current_line = lines[count];
				//alert(current_line);
				while (count2 < current_line.length) {
					document.getElementById("letter_table").rows[2*count+1].cells[count2].innerHTML = current_line[count2];
					if ((current_line[count2] != ' ') && (current_line[count2] != ',')) {
						//make a unique new ID
						new_id = "ID"+letter_count;
						//make a text input with this ID
						new_contents = "<input type='text' id=" + new_id + " maxlength='1' size='1' style='width: 15px;'/>";
						document.getElementById("letter_table").rows[(2*count)].cells[count2].innerHTML = new_contents;
						letter_count += 1;
					}	
					else {
						document.getElementById("letter_table").rows[(2*count)].cells[count2].innerHTML = 
						"<p style='color: #EEEEEE;'>_</p>";
					}
					count2 += 1;
				}
				count += 1;
				//alert(letter_count);
			}
		}
		
		function on_load() {
			//alert('loading');
			document.getElementById("name_label").style.color = "orange";	
			//document.getElementById("letter_table").rows[1].cells[1].innerHTML = 'Red';
			
			var phrase = select_phrase();
			original_phrase = phrase;
			
			new_phrase = phrase_encode(phrase);
			//alert(new_phrase);
			
			fill_grid(new_phrase);
		}
		
		function check_answer() {
			//alert('hello');
			//alert(document.getElementById("ID1").value);
			
			edited_phrase = ''
			count = 0;
			while (count < original_phrase.length) {
				if ((original_phrase[count] != ' ') && (original_phrase[count] != ',')){
					edited_phrase += original_phrase[count]
				}
				count += 1;
			}
			//alert(edited_phrase);
			//alert(edited_phrase.length)
			
			collected_letters = '';
			count = 0;
			while (count < edited_phrase.length) {
				collected_letters += (document.getElementById("ID"+count).value);
				count += 1;
			}
			//alert(collected_letters);
			
			if (collected_letters == edited_phrase){
				document.getElementById("response_jumbotron").style.display = "block";
				document.getElementById("response").innerHTML = "Nice Job!";
				document.getElementById("response_p").innerHTML = "Click 'New Game' to receive a new puzzle.";
				document.getElementById("try_button").style.display = "none";
			}
			else {
				document.getElementById("response_jumbotron").style.display = "block";
				document.getElementById("response").innerHTML = "Sorry! Wrong answer.";
				document.getElementById("response_p").innerHTML = "Click the 'Try Again' button to return to the puzzle. Click 'New Game' to receive a new puzzle";
				document.getElementById("try_button").style.display = "block";
				//alert('Sorry! Try again.');
			}
		}
		
		function go_back() {
			document.getElementById("response_jumbotron").style.display = "none";
		}
		
	</script>
	
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
    <script src="../../dist/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../../assets/js/ie10-viewport-bug-workaround.js"></script>
  </body>
</html>